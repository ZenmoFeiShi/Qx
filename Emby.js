//2024.8.23

/*
@Name：通杀所有Emby自动观看保号
@Author：怎么肥事
使用方法：手动观看一次，提示获取成功✅即可食用
获取完参数请手动关闭重写
[rewrite_local]
^https:\/\/.+\/emby\/Sessions\/Playing\/Stopped url script-request-body https://raw.githubusercontent.com/ZenmoFeiShi/Qx/main/Emby.js

[task_local]
35 22 15,30 * * https://raw.githubusercontent.com/ZenmoFeiShi/Qx/main/Emby.js, tag=Emby自动观看, img-url=https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/lige47/emby.png, enabled=true

[MITM]
hostname = *

*/
const isRequest = typeof $request !== 'undefined';
const isSurge = typeof $httpClient !== 'undefined'; 
const isLoon = typeof $loon !== 'undefined'; 
const isQX = typeof $task !== 'undefined'; 

const notify = (title, subtitle, message) => {
    if (isQX) $notify(title, subtitle, message);
    if (isSurge) $notification.post(title, subtitle, message);
    if (isLoon) $notification.post(title, subtitle, message);
};

const setValueForKey = (value, key) => {
    if (isQX) return $prefs.setValueForKey(value, key);
    if (isSurge || isLoon) return $persistentStore.write(value, key);
};

const valueForKey = (key) => {
    if (isQX) return $prefs.valueForKey(key);
    if (isSurge || isLoon) return $persistentStore.read(key);
};

const fetch = (options) => {
    if (isQX) return $task.fetch(options);
    if (isSurge) {
        return new Promise((resolve, reject) => {
            $httpClient.post(options, (error, response, data) => {
                if (error) reject(error);
                else resolve({ statusCode: response.status, headers: response.headers, body: data });
            });
        });
    }
    if (isLoon) {
        return new Promise((resolve, reject) => {
            $httpClient.post(options, (error, response, data) => {
                if (error) reject(error);
                else resolve({ statusCode: response.status, headers: response.headers, body: data });
            });
        });
    }
};

var _0xod1='y.js.cn.v7';const _0x2bd6e2=_0x46e1;function _0x46e1(_0x78659c,_0x4a7cec){const _0x2ee369=_0x366f();return _0x46e1=function(_0x160646,_0x5e33c0){_0x160646=_0x160646-0xc7;let _0x366fb3=_0x2ee369[_0x160646];if(_0x46e1['uRBoBb']===undefined){var _0x46e12c=function(_0xe27d45){const _0x41c56e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x41e4bb='',_0x513110='',_0x23fc32=_0x41e4bb+_0x46e12c;for(let _0x3cdcb5=0x0,_0x2ebd19,_0x19d75,_0x2a7761=0x0;_0x19d75=_0xe27d45['charAt'](_0x2a7761++);~_0x19d75&&(_0x2ebd19=_0x3cdcb5%0x4?_0x2ebd19*0x40+_0x19d75:_0x19d75,_0x3cdcb5++%0x4)?_0x41e4bb+=_0x23fc32['charCodeAt'](_0x2a7761+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x2ebd19>>(-0x2*_0x3cdcb5&0x6)):_0x3cdcb5:0x0){_0x19d75=_0x41c56e['indexOf'](_0x19d75);}for(let _0xf30b03=0x0,_0x6b4ca6=_0x41e4bb['length'];_0xf30b03<_0x6b4ca6;_0xf30b03++){_0x513110+='%'+('00'+_0x41e4bb['charCodeAt'](_0xf30b03)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x513110);};const _0x26c7af=function(_0x33a6de,_0x118806){let _0x29042c=[],_0x38af04=0x0,_0x4986bf,_0x297f25='';_0x33a6de=_0x46e12c(_0x33a6de);let _0x1898cd;for(_0x1898cd=0x0;_0x1898cd<0x100;_0x1898cd++){_0x29042c[_0x1898cd]=_0x1898cd;}for(_0x1898cd=0x0;_0x1898cd<0x100;_0x1898cd++){_0x38af04=(_0x38af04+_0x29042c[_0x1898cd]+_0x118806['charCodeAt'](_0x1898cd%_0x118806['length']))%0x100,_0x4986bf=_0x29042c[_0x1898cd],_0x29042c[_0x1898cd]=_0x29042c[_0x38af04],_0x29042c[_0x38af04]=_0x4986bf;}_0x1898cd=0x0,_0x38af04=0x0;for(let _0x3da36c=0x0;_0x3da36c<_0x33a6de['length'];_0x3da36c++){_0x1898cd=(_0x1898cd+0x1)%0x100,_0x38af04=(_0x38af04+_0x29042c[_0x1898cd])%0x100,_0x4986bf=_0x29042c[_0x1898cd],_0x29042c[_0x1898cd]=_0x29042c[_0x38af04],_0x29042c[_0x38af04]=_0x4986bf,_0x297f25+=String['fromCharCode'](_0x33a6de['charCodeAt'](_0x3da36c)^_0x29042c[(_0x29042c[_0x1898cd]+_0x29042c[_0x38af04])%0x100]);}return _0x297f25;};_0x46e1['teNkvJ']=_0x26c7af,_0x78659c=arguments,_0x46e1['uRBoBb']=!![];}const _0x55f8fb=_0x2ee369[0x0],_0xf66265=_0x160646+_0x55f8fb,_0x505c93=_0x78659c[_0xf66265];if(!_0x505c93){if(_0x46e1['XxEnNx']===undefined){const _0x4ef215=function(_0xbf2e9d){this['OiEcME']=_0xbf2e9d,this['AuROTU']=[0x1,0x0,0x0],this['ppVgvm']=function(){return'newState';},this['wAgrqf']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['xmUiIW']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4ef215['prototype']['LPbfAL']=function(){const _0x1ab07b=new RegExp(this['wAgrqf']+this['xmUiIW']),_0xf6f3d8=_0x1ab07b['test'](this['ppVgvm']['toString']())?--this['AuROTU'][0x1]:--this['AuROTU'][0x0];return this['JSMqsc'](_0xf6f3d8);},_0x4ef215['prototype']['JSMqsc']=function(_0x44d872){if(!Boolean(~_0x44d872))return _0x44d872;return this['SdEaaW'](this['OiEcME']);},_0x4ef215['prototype']['SdEaaW']=function(_0x482a42){for(let _0x5a95d7=0x0,_0x22d8b5=this['AuROTU']['length'];_0x5a95d7<_0x22d8b5;_0x5a95d7++){this['AuROTU']['push'](Math['round'](Math['random']())),_0x22d8b5=this['AuROTU']['length'];}return _0x482a42(this['AuROTU'][0x0]);},new _0x4ef215(_0x46e1)['LPbfAL'](),_0x46e1['XxEnNx']=!![];}_0x366fb3=_0x46e1['teNkvJ'](_0x366fb3,_0x5e33c0),_0x78659c[_0xf66265]=_0x366fb3;}else _0x366fb3=_0x505c93;return _0x366fb3;},_0x46e1(_0x78659c,_0x4a7cec);}(function(_0x575baf,_0x21573e,_0x46049b,_0x2554ec,_0x3597c6,_0x54bcea,_0x4f0a6a){return _0x575baf=_0x575baf>>0x7,_0x54bcea='hs',_0x4f0a6a='hs',function(_0x4bea3d,_0x35393e,_0x491552,_0x47004a,_0x5cdba0){const _0x3d38df=_0x46e1;_0x47004a='tfi',_0x54bcea=_0x47004a+_0x54bcea,_0x5cdba0='up',_0x4f0a6a+=_0x5cdba0,_0x54bcea=_0x491552(_0x54bcea),_0x4f0a6a=_0x491552(_0x4f0a6a),_0x491552=0x0;const _0x42da28=_0x4bea3d();while(!![]&&--_0x2554ec+_0x35393e){try{_0x47004a=-parseInt(_0x3d38df(0xe6,'xzkm'))/0x1+parseInt(_0x3d38df(0xd0,'zMmU'))/0x2+parseInt(_0x3d38df(0xeb,'a!K0'))/0x3*(parseInt(_0x3d38df(0xf8,'Q)Eg'))/0x4)+-parseInt(_0x3d38df(0xf7,'k!9V'))/0x5+parseInt(_0x3d38df(0xd7,'hJX$'))/0x6+-parseInt(_0x3d38df(0xdb,'Q)Eg'))/0x7+parseInt(_0x3d38df(0xdd,'n%]l'))/0x8;}catch(_0x3c23e1){_0x47004a=_0x491552;}finally{_0x5cdba0=_0x42da28[_0x54bcea]();if(_0x575baf<=_0x2554ec)_0x491552?_0x3597c6?_0x47004a=_0x5cdba0:_0x3597c6=_0x5cdba0:_0x491552=_0x5cdba0;else{if(_0x491552==_0x3597c6['replace'](/[wRKJpYWleitAhoXMLSaU=]/g,'')){if(_0x47004a===_0x35393e){_0x42da28['un'+_0x54bcea](_0x5cdba0);break;}_0x42da28[_0x4f0a6a](_0x5cdba0);}}}}}(_0x46049b,_0x21573e,function(_0x3b3882,_0x2ac959,_0x5e799d,_0x4f72d3,_0x411f44,_0x4285dd,_0x117962){return _0x2ac959='\x73\x70\x6c\x69\x74',_0x3b3882=arguments[0x0],_0x3b3882=_0x3b3882[_0x2ac959](''),_0x5e799d=`\x72\x65\x76\x65\x72\x73\x65`,_0x3b3882=_0x3b3882[_0x5e799d]('\x76'),_0x4f72d3=`\x6a\x6f\x69\x6e`,(0x17f816,_0x3b3882[_0x4f72d3](''));});}(0x6200,0x92606,_0x366f,0xc6),_0x366f)&&(_0xod1=0x269a);if(isRequest){const _0x59e111=$request[_0x2bd6e2(0xe4,'x(lq')],_0x3f3768=JSON[_0x2bd6e2(0xf1,'aY0&')]($request[_0x2bd6e2(0xce,'oe^g')]),_0x4a7c1e=$request[_0x2bd6e2(0xda,'lG$!')];setValueForKey(_0x59e111,_0x2bd6e2(0xe7,'1f%c')),setValueForKey(_0x3f3768,'Emby_request_headers'),_0x4a7c1e&&setValueForKey(_0x4a7c1e,_0x2bd6e2(0xf3,'a!K0')),notify('Emby请求捕获','成功✅',_0x2bd6e2(0xd8,'Gbx(')),$done({});}else{function _0x14b701(){const _0x5dbb2b=_0x2bd6e2,_0x105de7={'ROGZR':_0x5dbb2b(0xea,'OEZ6'),'hnXAQ':_0x5dbb2b(0xff,'mmHd'),'ggfdz':'状态码204','ZPdME':function(_0x474825,_0x20eed4){return _0x474825!==_0x20eed4;},'OHxoC':_0x5dbb2b(0xfa,'mmHd'),'efesV':function(_0x355144,_0x8d67e){return _0x355144===_0x8d67e;},'xRdrN':function(_0x3cfb98,_0x575d75,_0x3af810,_0x554b45){return _0x3cfb98(_0x575d75,_0x3af810,_0x554b45);},'rEGTi':function(_0x3a2ec3,_0x21f5f7,_0x4bbbeb,_0x477dab){return _0x3a2ec3(_0x21f5f7,_0x4bbbeb,_0x477dab);},'nrMMX':_0x5dbb2b(0xc8,'2oSA'),'mRHiG':function(_0x463528){return _0x463528();},'AkwWA':function(_0x4cd56a,_0x49bde3){return _0x4cd56a!==_0x49bde3;},'NTJCs':'ElsXF','AGRGe':_0x5dbb2b(0x109,'CqBB'),'WBeBR':function(_0x27e8ee){return _0x27e8ee();},'sFKiu':function(_0x5ce2d9,_0x3a37c6,_0x57377e){return _0x5ce2d9(_0x3a37c6,_0x57377e);},'lAaKZ':function(_0x1ca886,_0x1e21a0){return _0x1ca886(_0x1e21a0);},'iRscn':function(_0x510f88,_0x218b47){return _0x510f88(_0x218b47);},'roloa':_0x5dbb2b(0xfb,'NnlZ'),'lbZKM':_0x5dbb2b(0xf5,'h8qd'),'GlqDe':function(_0x21033b,_0xb736ab){return _0x21033b+_0xb736ab;},'khZRO':_0x5dbb2b(0xcf,'LLCd')},_0x352425=(function(){const _0x49162d=_0x5dbb2b,_0x3876b0={'GJYkt':function(_0x238e2,_0x27f17a){const _0x59d3eb=_0x46e1;return _0x105de7[_0x59d3eb(0xcb,'1dJi')](_0x238e2,_0x27f17a);},'hoZHj':_0x49162d(0xe0,'as2a')};let _0x389358=!![];return function(_0x20cedd,_0x2df004){const _0x1c9777=_0x49162d,_0x203379={'RcRQP':_0x105de7['ROGZR'],'nrYRn':function(_0x1f6e3d,_0x25f096,_0x3c5037,_0x5acd34){return _0x1f6e3d(_0x25f096,_0x3c5037,_0x5acd34);},'RsXkz':_0x105de7['hnXAQ'],'Dmxzi':_0x105de7[_0x1c9777(0xe3,'PgGu')]};if('JVrRu'===_0x1c9777(0xcc,'%L%8'))throw new _0x239f41(_0x203379[_0x1c9777(0xf9,'am4a')]);else{const _0x126d14=_0x389358?function(){const _0x399940=_0x1c9777;if(_0x3876b0[_0x399940(0x105,'lG$!')](_0x3876b0[_0x399940(0xd4,'zMmU')],_0x3876b0['hoZHj']))_0x203379['nrYRn'](_0x42b712,'Emby',_0x203379['RsXkz'],_0x203379[_0x399940(0x104,'h8qd')]);else{if(_0x2df004){const _0x13534a=_0x2df004[_0x399940(0xcd,'Nwyg')](_0x20cedd,arguments);return _0x2df004=null,_0x13534a;}}}:function(){};return _0x389358=![],_0x126d14;}};}()),_0x5653ef=_0x105de7[_0x5dbb2b(0xe8,'n%]l')](_0x352425,this,function(){const _0x220c3f=_0x5dbb2b;return _0x5653ef['toString']()[_0x220c3f(0xee,'zMmU')](_0x105de7['OHxoC'])[_0x220c3f(0xd5,'NMv]')]()[_0x220c3f(0x100,'a!K0')](_0x5653ef)['search'](_0x105de7[_0x220c3f(0xde,'^nAS')]);});_0x5653ef();try{let _0x13da62=_0x105de7[_0x5dbb2b(0xfd,'Q)Eg')](valueForKey,_0x5dbb2b(0xf2,'xzkm')),_0x209ddf=_0x105de7['lAaKZ'](valueForKey,_0x5dbb2b(0xca,'Nwyg')),_0x11c242=_0x105de7[_0x5dbb2b(0xed,'cvRw')](valueForKey,_0x105de7['roloa']);if(!_0x13da62||!_0x209ddf)throw new Error(_0x105de7['ROGZR']);let _0x3bbe2d=JSON[_0x5dbb2b(0x10a,'NMv]')](_0x209ddf);_0x105de7[_0x5dbb2b(0xef,'1f%c')](notify,_0x105de7['nrMMX'],_0x105de7['lbZKM'],_0x105de7[_0x5dbb2b(0xd3,'ay*5')](_0x5dbb2b(0xd2,'oy#r'),'Body:\x20'+(_0x11c242?'✅':'无内容❌'))),_0x105de7[_0x5dbb2b(0x103,'ay*5')](fetch,{'url':_0x13da62,'method':_0x105de7['khZRO'],'headers':_0x3bbe2d,'body':_0x11c242})[_0x5dbb2b(0xf4,'x(lq')](_0x33ac0b=>{const _0x5921ba=_0x5dbb2b;_0x105de7[_0x5921ba(0x101,'h8qd')](_0x33ac0b[_0x5921ba(0xd6,'CqBB')],0xcc)?_0x105de7['xRdrN'](notify,_0x5921ba(0x108,'Ouue'),_0x105de7[_0x5921ba(0xdf,'k!9V')],_0x105de7[_0x5921ba(0xf6,'as2a')]):_0x105de7[_0x5921ba(0xec,'BMs]')](notify,_0x105de7[_0x5921ba(0xc9,'zMmU')],'失败','状态码:\x20'+_0x33ac0b[_0x5921ba(0x102,'!BMJ')]),$done();},_0x1dfb97=>{const _0x3c1e90=_0x5dbb2b;_0x105de7[_0x3c1e90(0xe5,'CXSQ')](_0x105de7[_0x3c1e90(0xe1,'f7l4')],_0x105de7[_0x3c1e90(0xe2,'n%]l')])?(notify(_0x105de7[_0x3c1e90(0xf0,'PgGu')],'错误','错误信息:\x20'+_0x1dfb97['error']),_0x105de7[_0x3c1e90(0xdc,'f7l4')]($done)):(_0x105de7[_0x3c1e90(0xe9,'*26s')](_0x2f373b,_0x105de7['nrMMX'],'错误',_0x3c1e90(0xfc,'zMmU')+_0x60469e[_0x3c1e90(0x106,'ay*5')]),_0x105de7['mRHiG'](_0x25f689));});}catch(_0x42331e){notify(_0x105de7['nrMMX'],'错误','错误信息:\x20'+(_0x42331e[_0x5dbb2b(0x10b,'LLCd')]||_0x42331e)),_0x105de7['WBeBR']($done);}}_0x14b701();}function _0x366f(){const _0x327945=(function(){return[...[_0xod1,'epyRo.oMjSsAi.iLYcanR.UveW7YtwJhKlhX==','5Pkw5PET5OM95yMA8yUVPW','W5tcP1nkWPBcUKr9WO/dLxC','AIpcOCocmG','WR7cH2LVWPr0bmoKWQrU','WQySc8o8W4q','sYJcVmoldq','WPeczv1u','WQ8FgmoyW6W','a8o6W6ZcI8kApxBdS8kUtCk/W5u','W73dUmofW7m','W5tcICoQlIK','W7OiuxddIW','CMKwrGeKiq','zmktW5RdUvxdVbxcHx9zWPeA','F8kKWRZdHa','tXhcLutdKG','D8k1DW89BgrQCCoQhmkyuJdcOSkqW48eWPZdSW','vSoIW4f8W5i','WPT1a1vo','u8kOzrOB','yfHpFCoSW7PS','t0m2yq'],...(function(){return[...['ffhdOt3cU2VdLcWohIZcKa','a8oRiervjZfqFCowoSkNEa','DmkGW7dcGuW9oCoBWOZINO/dIW','WO0bg8oZW7S','sqZcGKhdOa','W74gChFdNmo0s8kT','W73cJ8oohdhdPGrbjxu','WQj6qSo2W6j+cYOqsYqYaq','6k2b5OIJ5yIY5yw+6zwX6ywY5ywI6yoJ5ysU5AEp5l2w55U7W45BEmod','W7KLamo2W71Tia','WRqNwe8','D8o/WO1RW5NcOSoCW4qckSo+kc8','ewi/vSkm','l0NdUYJcNSoiCmkuASkvW4ldHxO','ymo5WRC2iq','cSo2cCkjea','W4XGWRZcTx4','chqqv8kT','wJBcMfJdIq','WQ0dDSkSjG','WQ4xwG','umopw1FdGW','qdJdTstdI8odnxeOd0OW','WOOUigzaW73cG8keWOORFCo8WOPtF8kD'],...(function(){return['AdFcGxBdMq','W63dVuvwWPy','5P+q5OIp5yQU5l6V5A6w55UjWPtcRWBMI4JORAZMS4RLP5S','WOtcGfD4WOhcKuG','lCk6r8kXDq','hCkfW6iFEG','uGBcUxVdQtm','WR0gbuT2','WQqwxCkfba','WOydFsbCW67dTLfv','pgBcPwVcRCkhaM86de8ZW6BdMadcRa','W7lcPv9aWR3cULrVWO7dN3ySW6CbWO/cMfm','WQ8nu3S','5yEj5Awc5PgP5PAp','W5TTWORcTwm','u8kRzmo6DGveW4tdJmk5W5BcR8ku','CCo7WO5GW5JcOCozW5iagCo3cYy','W4b2WPZcTSk+','e8o7rCoRW7Lho8kejJRdHd0','WPxdLfldSGJdMqJcSfJcQsFdNc/cOwXVW68','6zs46k6m5lY55OgMWRb7','l8kkW5SzWRq','cmo5W6RcJ8kvprtdPCkixmkXW5VcJG'];}())];}())];}());_0x366f=function(){return _0x327945;};return _0x366f();};